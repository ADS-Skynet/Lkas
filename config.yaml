# Lane Keeping Assist System Configuration

# Lane Detection - Computer Vision
cv_detector:
  # Canny edge detection
  canny_low: 50
  canny_high: 150

  # Hough transform
  hough_rho: 2
  hough_theta: 0.017453  # 1 degree in radians (pi/180)
  hough_threshold: 50
  hough_min_line_len: 40
  hough_max_line_gap: 100

  # Temporal smoothing
  smoothing_factor: 0.7

  # Lane detection thresholds
  min_slope: 0.5  # Minimum absolute slope to be considered a lane

  # ROI configuration (broader detection area)
  roi_bottom_left_x: 0.05   # Fraction of width (bottom-left corner)
  roi_top_left_x: 0.35      # Fraction of width (top-left corner)
  roi_top_right_x: 0.65     # Fraction of width (top-right corner)
  roi_bottom_right_x: 0.95  # Fraction of width (bottom-right corner)
  roi_top_y: 0.5            # Fraction of height (look at top 50% of image)

# Lane Detection - Deep Learning
dl_detector:
  model_type: "pretrained"  # 'pretrained', 'simple', or 'full'
  input_size: [256, 256]
  threshold: 0.5
  device: "auto"  # 'cpu', 'cuda', or 'auto'

# Lane Analysis
lane_analyzer:
  drift_threshold: 0.15      # 15% of lane width
  departure_threshold: 0.35  # 35% of lane width
  lane_width_meters: 3.7     # Standard US highway lane
  max_heading_degrees: 30.0  # Maximum heading angle

  # Steering controller gains
  kp: 0.5  # Proportional gain
  kd: 0.1  # Derivative gain

# System
system:
  detection_method: "cv"  # "cv" or "dl"
  target_fps: 30
  enable_logging: true
  log_file: "lkas.log"

# LKAS Launcher
launcher:
  # Process retry configuration
  retry_count: 60           # Number of retries for server connections
  retry_delay: 0.5          # Delay between retries in seconds

  # Process initialization timeouts
  decision_init_timeout: 3.0    # Decision server initialization timeout (seconds)
  detection_init_timeout: 4.0   # Detection server initialization timeout (seconds)
  process_stop_timeout: 5.0     # Graceful process termination timeout (seconds)

  # Terminal display
  terminal_width: 70        # Width of terminal output
  enable_footer: true       # Enable persistent footer display

  # Logging
  log_file: "lkas_run.log"  # Path to launcher log file

  # Broadcasting (ZMQ)
  jpeg_quality: 85          # JPEG quality for frame broadcasting (0-100)
  broadcast_log_interval: 100  # Log broadcast status every N frames

# ZMQ Communication (shared with simulation/viewer)
zmq:
  broadcast_port: 5557    # Port for frame/detection broadcasting
  action_port: 5558       # Port for action commands
  parameter_port: 5559    # Port for parameter updates
  broker_port: 5560       # Port for broker communication
